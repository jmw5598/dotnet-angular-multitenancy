<div class="block" *ngIf="userAccountForm" [formGroup]="userAccountForm">
  <!-- <nz-page-header nzTitle="Log In" class="px-0 pb-3 pt-0"></nz-page-header> -->

  <div class="w-100" nz-row [nzGutter]="16">
    <div class="bordered-right" nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="8" nzXl="8">
      <div class="block p-4">
        <!-- User Avatar -->
        <div class="my-5">
          <nz-upload
              class="avatar-uploader text-center"
              nzAction="https://www.mocky.io/v2/5cc8019d300000980a055e76"
              nzName="avatar"
              nzListType="picture-card"
              [nzShowUploadList]="false"
              [nzBeforeUpload]="beforeUpload"
              (nzChange)="handleChange($event)">
            <ng-container *ngIf="!avatarUrl">
              <i class="upload-icon" nz-icon [nzType]="loading ? 'loading' : 'plus'"></i>
              <div class="ant-upload-text">Upload</div>
            </ng-container>
            <img *ngIf="avatarUrl" [src]="avatarUrl" style="width: 100%" />
          </nz-upload>
          <!-- <img class="block mx-auto my-5" style="border-radius: 50%; width: 128px; height: 128px;" src="https://i.pravatar.cc/300" /> -->
        </div>

        <!-- User Details Section -->
        <nz-divider nzOrientation="left" nzText="Your User Crendentials"></nz-divider>
        <div formGroupName="user">
          <nz-form-item>
            <nz-form-control [nzErrorTip]="emailErrorTemplate">
              <nz-input-group nzPrefixIcon="user">
                <input type="text" nz-input formControlName="userName" placeholder="Email" />
              </nz-input-group>
              <ng-template #emailErrorTemplate let-control>
                <ng-container *ngIf="control.hasError('required')">Email is required!</ng-container>
                <ng-container *ngIf="control.hasError('emailExists')">Email already exists!</ng-container>
                <ng-container *ngIf="control.hasError('email')">Invalid email format!</ng-container>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-control [nzErrorTip]="passwordErrorTemplate">
              <nz-input-group nzPrefixIcon="lock">
                <input type="password" nz-input formControlName="password" placeholder="Password" />
              </nz-input-group>
              <ng-template #passwordErrorTemplate let-control>
                <ng-container *ngIf="control.hasError('required')">Password is required!</ng-container>
                <ng-container *ngIf="control.hasError('pattern')">Password must be 6 characters (upper/lower case, numbers and symbols)!</ng-container>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-control [nzErrorTip]="confirmPasswordErrorTemplate">
              <nz-input-group nzPrefixIcon="lock">
                <input type="password" nz-input formControlName="confirmPassword" placeholder="Confirm Password" />
              </nz-input-group>
              <ng-template #confirmPasswordErrorTemplate let-control>
                <ng-container *ngIf="control.hasError('required')">Confirm Password is required!</ng-container>
                <ng-container *ngIf="control.hasError('mustMatch')">Confirm Password must match Password!</ng-container>
                <ng-container *ngIf="control.hasError('pattern')">Password must be 6 characters (upper/lower case, numbers and symbols)!</ng-container>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </div>

        <!-- Profile Details Section -->
        <nz-divider nzOrientation="left" nzText="Your Profile Details"></nz-divider>
        <div formGroupName="profile">
          <nz-form-item>
            <nz-form-control nzErrorTip="Please input your First Name!">
              <nz-input-group nzPrefixIcon="user">
                <input type="text" nz-input formControlName="firstName" placeholder="First Name" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-control nzErrorTip="Please input your Last Name!">
              <nz-input-group nzPrefixIcon="user">
                <input type="text" nz-input formControlName="lastName" placeholder="Last Name" />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
      
      </div>
    </div>
    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="16" nzXl="16">
      <div class="block p-4">
        <!-- User Details Section -->
        <nz-divider nzOrientation="left" nzText="Your User Permissions"></nz-divider>
        <ng-container [formGroup]="userAccountForm">
          <ng-container formArrayName="userPermissionGroups">
            <ng-container [formGroupName]="i" *ngFor="let group of userPermissionGroups.controls; let i = index">
              
              <nz-collapse class="mb-2">
                  <nz-collapse-panel
                    class="p-0"
                    [nzHeader]="permissionPanelHeader"
                    [nzActive]="group.value.hasAccess"
                    [nzDisabled]="!group.value.hasAccess"
                    [nzShowArrow]="false">
                  <ng-template #permissionPanelHeader>
                    <div nz-row  [nzGutter]="16">
                      <div nz-col nzXs="24" nzSm="26" nzMd="12" nzLg="12" nzXl="15" class="permissions-header-text">
                        <label 
                            nz-checkbox 
                            formControlName="hasAccess"
                            (ngModelChange)="onRootPermissionModuleChange($event, group)">
                          {{ group?.value.userPermission?.permission?.name }}
                        </label>
                        <div class="ml-5">
                          <small><a>Show all {{ group?.value?.userPermission?.childUserPermissions?.length || 0 }} sub permissions</a></small>
                        </div>  
                      </div>
                      <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="9" class="permissions-header-actions" formGroupName="userPermission">
                        <div class="permissions-header-action">
                          <div class="permissions-header-action-label">Create</div>
                          <nz-switch 
                              (ngModelChange)="onRootPermissionModuleCanCreateChange($event, group)"
                              formControlName="canCreate"
                              nzSize="small"
                              [nzDisabled]="!group.value.hasAccess"
                              (click)="$event.stopPropagation()">
                          </nz-switch>
                        </div>
                        <div class="permissions-header-action">
                          <div class="permissions-header-action-label">Read</div>
                          <nz-switch
                              (ngModelChange)="onRootPermissionModuleCanReadChange($event, group)"
                              formControlName="canRead"
                              nzSize="small" 
                              [nzDisabled]="!group.value.hasAccess"
                              (click)="$event.stopPropagation()">
                          </nz-switch>
                        </div>
                        <div class="permissions-header-action">
                          <div class="permissions-header-action-label">Update</div>
                          <nz-switch 
                              (ngModelChange)="onRootPermissionModuleCanUpdateChange($event, group)"
                              formControlName="canUpdate"
                              nzSize="small" 
                              [nzDisabled]="!group.value.hasAccess"
                              (click)="$event.stopPropagation()">
                          </nz-switch>
                        </div>
                        <div class="permissions-header-action">
                          <div class="permissions-header-action-label">Delete</div>
                          <nz-switch 
                              (ngModelChange)="onRootPermissionModuleCanDeleteChange($event, group)"
                              formControlName="canDelete"
                              nzSize="small" 
                              [nzDisabled]="!group.value.hasAccess"
                              (click)="$event.stopPropagation()">
                          </nz-switch>
                        </div>
                      </div>
                    </div>
                  </ng-template>
                  <ng-container formGroupName="userPermission">
                    <ul class="bordered-none" nz-list nzBordered nzSize="large" formArrayName="childUserPermissions">
                      <li 
                          nz-list-item 
                          nzNoFlex
                          [formGroupName]="c"
                          *ngFor="let childGroup of getChildPermissionsFormArray(group)?.controls; let c = index">
                        <div nz-row  [nzGutter]="16">
                          <div nz-col nzXs="24" nzSm="26" nzMd="12" nzLg="12" nzXl="15"  class="permissions-header-text">
                            {{ childGroup?.value?.permission?.name }}
                          </div>
                          <div nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="9" class="permissions-header-actions">
                            <div class="permissions-header-action">
                              <label 
                                  formControlName="canCreate"
                                  nz-checkbox>
                              </label>
                            </div>
                            <div class="permissions-header-action">
                              <label 
                                  formControlName="canRead"
                                  nz-checkbox>
                              </label>
                            </div>
                            <div class="permissions-header-action">
                              <label 
                                  formControlName="canUpdate"
                                  nz-checkbox>
                              </label>
                            </div>
                            <div class="permissions-header-action">
                              <label 
                                  formControlName="canDelete"
                                  nz-checkbox>
                              </label>
                            </div>
                          </div>
                        </div>
                      </li>
                    </ul>
                  </ng-container>
                </nz-collapse-panel>
              </nz-collapse>

            </ng-container>
          </ng-container>
        </ng-container>

      </div>
    </div>
  </div>
</div>